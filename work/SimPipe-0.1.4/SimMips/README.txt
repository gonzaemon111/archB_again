/**********************************************************************
 * SimMips: Simple Computer Simulator of MIPS    Arch Lab. TOKYO TECH *
 **********************************************************************/
COPYRIGHT

SimMips is free software.
See the file COPYING for copying permission.

/**********************************************************************/
About SimMips

計算機アーキテクチャやオペレーティングシステムの教育・研究ツールとして，
システムシミュレータへの要求が高まっています．しかしながら，既存のシス
テムシミュレータは，数多くのプラットフォームに対応することや，高速に動
作することに主眼をおいているため，教育・研究において重要となるシンプル
さや可読性を失っています．

こうした既存のシミュレータとは一線を画し，シンプルさや可読性，拡張性を
重視した，MIPS32命令セットのプロセッサを含むシステムシミュレータである
SimMips の開発をおこなっています．可読性と実行速度との間にはトレードオ
フがありますが，プロセッサの高速化により，高い可読性と現実的な実行速度
との両立が可能となりつつあります．SimMips は，計算機システムやOSの教育・
研究・開発に大いに利点を発揮します．

/**********************************************************************/
Building your SimMips binary

SimMipsはクリーンなC++で記述されています．
Intel Linux, Intel Cygwin などの環境で動作を確認しています．
現時点ではBig-Endianのプラットフォーム，例えばCell/B.E. Linux などの環
境では動作しません．

SimMips の実行ファイルを作成するためにはコンパイルが必要です．
SimMips の配布パッケージをダウンロードして，展開します．
（このファイルを読んでいるということは，既にパッケージが展開されている
　かもしれませんが．）

例えば，ファイル名がSimMips-0.5.0.tgz ならば，以下のコマンドでパッケー
ジを展開します．

$ tar xvzf SimMips-0.5.0.tgz

SimMips-0.5.0 というディレクトリが作成され，その中にソースコードなど
が展開されます．次に，展開されたディレクトリに移動してコンパイルします．

$ cd SimMips-0.5.0
$ make

コンパイルが正常に終了すれば，SimMips という名前の実行ファイルが生成さ
れます．

/**********************************************************************/
Let's run SimMips

パラメータを指定せずにSimMips を実行すると，簡単な使い方が表示されます．

| $ ./SimMips
| ## SimMips: Simple Computer Simulator of MIPS Version 0.5.0 2008-11-05
| Usage: simmips [-options] object_file_name
|   -e[num][kmg]: stop simulation after num cycles executed
|   -d[level]: debug mode
|   -i: put instruction mix after simulation
|   -m: use multi-cycle execution model
|   -M [filename]: specify machine setting file

サンプルとして，クイックソートのプログラムがtest/qsortに置かれています．
まずは，このプログラムをSimMips で動作させてみましょう．

| $ ./SimMips test/qsort
| ## SimMips: Simple Computer Simulator of MIPS Version 0.5.0 2008-11-05
|
| Before:   65536 items quick sorting.
| a[    0] =        9086
| a[  200] =       28147
| a[  400] =        7617
| a[  600] =        9586
| a[  800] =       18764
| a[ 1000] =       28363
| a[ 1200] =       23597
| a[ 1400] =       26600
| a[ 1600] =        6196
| a[ 1800] =       12923
| 
| After:   65536 items quick sorting.
| a[    0] =           0
| a[  200] =          98
| a[  400] =         197
| a[  600] =         300
| a[  800] =         402
| a[ 1000] =         503
| a[ 1200] =         600
| a[ 1400] =         701
| a[ 1600] =         802
| a[ 1800] =         897
| 
| ## cpu stopped
| ## cycle count: 17663749
| ## inst count: 17663749
| ## simulation time:    1.431
| ## mips: 12.343

上のようなメッセージが表示されましたか？
実行時間など(一番下の2行) は，利用している計算機によって変化します．

/**********************************************************************/
Command Line Options

-eオプションは，一定サイクルの実行が完了するとシミュレーションを終了す
るオプションです．接尾辞として，k またはK(1,000)，m またはM(100万)，
g またはG(10億) が利用できます．

| $ ./SimMips -e10k test/qsort
| ## SimMips: Simple Computer Simulator of MIPS Version 0.5.0 2008-11-05
| 
| ## cycle count reaches the limit
| ## cycle count: 10000
| ## inst count: 10000
| ## simulation time:    0.001
| ## mips: 11.455

-dオプションは，デバッグモードです．1〜4までのモードを指定します．
-d1 は，シミュレーション終了時にレジスタ値とメモリの内容を表示します．
-d2 は，実行された命令列を表示します．
-d3 は，実行された命令列と読み書きされたレジスタの値を表示します．
-d4 は，発生した例外とTLB の読み書き履歴を表示します(OSモード)．

-iオプションは，シミュレーション終了時に実行された命令の種類と回数を表
示します．使用された回数が多い順に並べ替えられます．

-mオプションは，実行モデルとしてマルチサイクルモデルを採ります．
通常SimMips は１サイクルに１つの命令を実行する機能レベルの実行モデルを
使用していますが，このオプションを使用すると１つの命令の命令を複数のス
テージへと分割し，５〜７サイクルかけて実行します．

-Mオプションは，メモリやレジスタの初期設定用のファイルを指定します．
詳細仕様は，test/mem_test.txt に記載しています．

/**********************************************************************/
SimMips Source Code

展開したディレクトリには，比較的，読みやすい形式に加工したソースコード
のPDF(code.pdf)ファイルがあります．ソースコードを眺める前に，こちらに
目を通すとよいかもしれません．

/**********************************************************************/
SimMips History

主要なバージョンを記載しています．

v0.5.3 2009-01-09 (4,440 lines)
・DIV, DIVU命令のゼロ除算に対する取り扱いを修正．
・動作テスト用バイナリを修正．

v0.5.2 2009-01-09 (4,432 lines)
・MULT命令の実装に誤りがあったのを修正．

v0.5.1 2008-12-18 (4,432 lines)
・MieruPC-2008のメモリマップに対応．

v0.5.0 2008-11-05 (4,422 lines)
・MieruPC 向けに別で開発していたバージョンを統合．v0.5.0として公開．

v0.4.9 2008-08-13 (4,090 lines)
・ソースコードの見直しや，機能の追加などを随時行ってきた．

v0.4.0 2008-06-17 (3,765 lines)
・OSモードのバグ取りが終わる．シェルが立ち上がり，lsなどの動作を確認．

v0.3.1 2008-06-04 (3,459 lines)
・割り込みコントローラとシリアルインタフェースを実装．
　詳細な検証はしていない．

v0.3.0 2008-05-27 (2,980 lines)
・Coprocessor 0(CP0)を実装．詳細な検証はしていない．

v0.2.0 2008-04-14 (2,384 lines)
・App モードの実装終了．nqueenプログラムが動作．

/**********************************************************************/
MieruPC Project

SimMips の開発は，MieruPC プロジェクト（中身が見える計算機システムを構
築する研究・教育プロジェクト）の一環としても行われています．
MieruPC プロジェクトに関する情報は現在準備中です．
MieruPC-2008(MieruPC Version 1.0) の成果は，2009年前半に公開を予定して
います．

/**********************************************************************/
Reference

[1] 藤枝直輝, 渡邉伸平, 吉瀬謙二: SimMips: 教育・研究に有用なLinuxが動
く5000行のMIPSシステムシミュレータ(発表予定), 第20回コンピュータシステ
ム・シンポジウム(ComSys2008)論文集 (November 2008).

[2] 吉瀬謙二, 佐藤真平, 森谷章, 藤枝直輝, 若杉祐太, 渡邉伸平, 植原昂,
森洋介, 高前田伸也, 高橋朝英, 棟岡朋也, 山田裕介, 権藤克彦, 小林良太郎,
三好健文, 中條拓伯: MieruPC プロジェクト: 中身が見える計算機システムを
構築する研究・教育プロジェクト(発表予定), 第20回コンピュータシステム・
シンポジウム(ComSys2008) (November 2008).

[3] 渡邉伸平, 藤枝直輝, 若杉祐太, 高前田伸也, 森洋介, 吉瀬謙二: MIPSシ
ステムシミュレータSimMips を活用した組込みシステム開発の検討(発表予定),
情報処理学会研究報告 2008-EMB-10 (November 2008).

/**********************************************************************/